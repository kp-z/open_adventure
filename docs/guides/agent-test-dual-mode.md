# AgentTest 双模式交互指南

**创建日期**：2026-02-28
**状态**：已发布

## 目录
- [概述](#概述)
- [对话框模式](#对话框模式)
- [终端模式](#终端模式)
- [使用方法](#使用方法)
- [模式对比](#模式对比)
- [常见问题](#常见问题)

## 概述

AgentTest 页面提供了两种交互模式，让您可以根据不同的使用场景选择最合适的方式与 Agent 进行交互：

- **对话框模式**：微信风格的气泡对话界面，适合快速测试和查看格式化输出
- **终端模式**：真实的终端环境，适合调试和查看原始日志

两种模式可以随时切换，满足不同的测试需求。

## 对话框模式

### 特点

**微信风格界面**
- 用户消息显示在右侧（蓝色气泡）
- Agent 回复显示在左侧（灰色气泡）
- 清晰的视觉区分，易于阅读

**一键优化 Prompt**
- 点击输入框右侧的"优化"按钮
- 自动调用 `prompt_optimizer` 技能
- 将您的输入优化为更精确的指令
- 优化后可以编辑或直接发送

**实时流式输出**
- Agent 回复实时显示
- 支持 Markdown 格式渲染
- 代码块语法高亮
- 流畅的打字机效果

**适用场景**
- 快速测试 Agent 功能
- 查看格式化的输出结果
- 需要清晰的对话历史
- 演示或展示 Agent 能力

### 使用技巧

1. **使用 Prompt 优化**：对于复杂的需求，先点击"优化"按钮，让系统帮您生成更精确的指令
2. **查看历史记录**：所有对话历史都会保存，方便回顾和对比
3. **复制输出**：可以直接复制 Agent 的回复内容
4. **Markdown 支持**：Agent 的回复支持完整的 Markdown 格式，包括表格、列表、代码块等

## 终端模式

### 特点

**真实终端环境**
- 通过 WebSocket PTY 与 Agent 交互
- 支持完整的终端特性（颜色、光标控制等）
- 实时双向通信
- 原始日志输出

**完整的终端功能**
- 支持 ANSI 转义序列
- 彩色输出
- 光标定位
- 终端尺寸自适应

**适用场景**
- 调试 Agent 执行过程
- 查看详细的日志信息
- 需要终端交互的场景
- 开发和测试阶段

### 使用技巧

1. **查看原始日志**：终端模式显示 Agent 的原始输出，包括调试信息
2. **实时监控**：可以实时看到 Agent 的执行过程
3. **终端命令**：支持标准的终端操作（如果 Agent 支持）
4. **调试信息**：查看详细的错误信息和堆栈跟踪

## 使用方法

### 切换模式

1. 进入 Agent 详情页面
2. 找到右上角的模式切换按钮
   - 对话框图标：切换到对话框模式
   - 终端图标：切换到终端模式
3. 点击按钮即可切换模式

### 对话框模式操作

**发送消息**
1. 在底部输入框输入您的问题或指令
2. 点击"发送"按钮或按 Enter 键
3. 等待 Agent 回复

**优化 Prompt**
1. 在输入框输入您的初步想法
2. 点击"优化"按钮
3. 系统会调用 `prompt_optimizer` 优化您的输入
4. 查看优化结果，可以继续编辑
5. 点击"发送"按钮发送优化后的 prompt

**查看历史**
- 向上滚动查看之前的对话
- 所有消息都会保存在当前会话中

### 终端模式操作

**发送命令**
1. 在终端输入框输入命令或消息
2. 按 Enter 键发送
3. 查看 Agent 的实时输出

**查看日志**
- 终端会显示所有输出，包括调试信息
- 支持彩色输出和格式化
- 可以滚动查看历史日志

## 模式对比

| 特性 | 对话框模式 | 终端模式 |
|------|-----------|---------|
| 界面风格 | 微信风格气泡 | 终端命令行 |
| 输出格式 | Markdown 渲染 | 原始文本 |
| Prompt 优化 | ✅ 支持 | ❌ 不支持 |
| 实时流式输出 | ✅ 支持 | ✅ 支持 |
| 调试信息 | ❌ 隐藏 | ✅ 显示 |
| 代码高亮 | ✅ 自动 | ⚠️ 终端颜色 |
| 适用场景 | 快速测试、演示 | 调试、开发 |
| 学习曲线 | 低 | 中 |

## 常见问题

### Q1: 如何选择使用哪种模式？

**A:** 根据您的使用场景选择：
- **快速测试功能**：使用对话框模式，界面友好，输出清晰
- **调试问题**：使用终端模式，可以看到详细的日志和错误信息
- **演示给他人**：使用对话框模式，视觉效果更好
- **开发阶段**：使用终端模式，方便查看执行细节

### Q2: 切换模式会丢失历史记录吗？

**A:** 不会。每种模式都有独立的历史记录：
- 对话框模式的对话历史会保存
- 终端模式的输出历史也会保存
- 切换回来时可以看到之前的内容

### Q3: Prompt 优化功能如何工作？

**A:** Prompt 优化功能会：
1. 调用 `prompt_optimizer` 技能
2. 分析您的输入意图
3. 生成更精确、更结构化的指令
4. 返回优化后的 prompt 供您确认

这个功能特别适合：
- 不确定如何表达需求时
- 需要更精确的指令时
- 想要学习如何写好 prompt 时

### Q4: 为什么终端模式没有 Prompt 优化？

**A:** 终端模式设计用于：
- 直接与 Agent 交互
- 查看原始输出和日志
- 调试和开发场景

在这些场景下，用户通常需要直接控制输入，不需要额外的优化步骤。如果需要优化 prompt，建议使用对话框模式。

### Q5: 可以同时使用两种模式吗？

**A:** 不可以。同一时间只能使用一种模式，但您可以随时切换：
- 在对话框模式测试功能
- 切换到终端模式查看详细日志
- 再切换回对话框模式继续测试

### Q6: 终端模式支持哪些终端特性？

**A:** 终端模式支持：
- ANSI 转义序列（颜色、样式）
- 光标控制
- 终端尺寸自适应
- 实时双向通信

但不支持：
- 交互式程序（如 vim、nano）
- 需要特殊终端功能的程序

### Q7: 如何清空对话历史？

**A:** 目前对话历史会在页面刷新后清空。如果需要保存重要的对话记录，建议：
- 复制重要的回复内容
- 或使用浏览器的截图功能

### Q8: 遇到问题如何反馈？

**A:** 如果遇到问题：
1. 切换到终端模式查看详细的错误信息
2. 复制错误日志
3. 向开发团队反馈，包含：
   - 使用的模式
   - 输入的内容
   - 错误信息或异常行为
   - 浏览器和操作系统信息

## 最佳实践

### 对话框模式

1. **善用 Prompt 优化**：对于复杂需求，先优化再发送
2. **保持对话连贯**：Agent 可以理解上下文，不需要每次都重复背景信息
3. **利用 Markdown**：Agent 的回复支持 Markdown，可以包含表格、列表、代码等
4. **及时保存重要内容**：页面刷新会清空历史，重要内容及时复制保存

### 终端模式

1. **查看完整日志**：遇到问题时，终端模式可以看到完整的执行过程
2. **注意输出格式**：终端输出是原始文本，可能包含 ANSI 转义序列
3. **调试优先**：开发和调试阶段建议使用终端模式
4. **性能监控**：可以看到 Agent 的执行时间和资源使用情况

## 技术细节

### 对话框模式实现

- 基于 HTTP SSE (Server-Sent Events) 实现流式输出
- 使用 React 组件渲染 Markdown
- 支持代码块语法高亮（Prism.js）
- 自动滚动到最新消息

### 终端模式实现

- 基于 WebSocket 实现双向通信
- 使用 xterm.js 渲染终端
- 后端通过 PTY (Pseudo Terminal) 与 Agent 交互
- 支持完整的 ANSI 转义序列

## 相关文档

- [Agent 管理指南](./agent-management.md)
- [Workflow 执行指南](./workflow-execution.md)
- [API 文档](../api/README.md)

---

**更新日期**：2026-02-28
**版本**：v1.0.0
