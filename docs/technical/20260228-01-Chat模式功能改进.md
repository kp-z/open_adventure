# Chat 模式功能改进

**创建日期**：2026-02-28
**状态**：已完成

## 改进内容

### 1. 自动发送启动消息
- 进入 Chat 模式时自动发送欢迎消息激活 agent
- 消息内容：`你好！我是 {agentName}。请介绍一下你的能力。`
- 延迟 500ms 发送，确保组件完全加载
- 使用 `hasAutoSent` 状态防止重复发送

### 2. 消息折叠功能
- 消息内容超过 5 行时自动折叠
- 显示"展开 (N 行)"按钮
- 点击可展开/收起完整内容
- 使用 `ChevronDown`/`ChevronUp` 图标

### 3. Markdown 渲染
- 使用 `react-markdown` 渲染消息内容
- 支持 GitHub Flavored Markdown (GFM)
- 代码高亮使用 `rehype-highlight`
- 自定义样式适配深色主题

## 技术实现

### 依赖
- `react-markdown`: ^10.1.0
- `remark-gfm`: ^4.0.1
- `rehype-highlight`: ^7.0.2
- `highlight.js`: 11.11.1 (通过 rehype-highlight 安装)

### 文件修改
1. `ChatView.tsx`
   - 添加 `hasAutoSent` 状态
   - 使用 `useCallback` 包装 `handleSend`
   - 添加自动发送 useEffect

2. `MessageBubble.tsx`
   - 添加折叠/展开状态
   - 集成 ReactMarkdown
   - 自定义 Markdown 组件样式

## 测试步骤

1. 启动前后端服务
2. 打开 Agents 页面
3. 点击任意 Agent 的"测试"按钮
4. 切换到"Chat"标签
5. 验证功能：
   - 自动发送启动消息
   - 长消息自动折叠
   - Markdown 格式正确渲染
   - 代码块高亮显示

## 注意事项
- 自动发送仅在首次加载时触发一次
- 折叠阈值为 5 行（可根据需要调整）
- Markdown 渲染支持 GFM 扩展语法
