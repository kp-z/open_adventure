# Claude Manager v0.1.3 发布说明

**发布日期**: 2026-02-27
**版本**: v0.1.3
**类型**: Bug 修复版本

## 修复的问题

### 1. 修复发布包在其他 Mac 环境运行失败的问题

**问题描述**:
v0.1.2 发布包在其他 Mac 环境下运行时出现 multiprocessing 错误，导致服务无法启动。

**根本原因**:
1. uvicorn 的 `reload=True` 在发布包环境下会启动子进程监控文件变化，在某些环境下导致 multiprocessing 失败
2. 打包时包含了开发环境的 `.env` 配置文件，包含绝对路径
3. `start.sh` 脚本的路径处理不够健壮
4. 缺少环境检测和配置初始化逻辑

**解决方案**:
- 修改 `backend/run.py`，添加环境变量控制 reload 模式，生产环境禁用 reload
- 改进 `start.sh` 脚本，添加更健壮的路径处理和配置初始化
- 修正 `backend/.env.example`，使用正确的配置示例
- 创建规范的打包脚本 `scripts/build-release.sh`，确保排除开发文件

## 变更详情

### 修改的文件

#### 1. backend/run.py
```python
# 添加环境变量控制
is_dev = os.getenv("ENV", "production") == "development"
uvicorn.run(..., reload=is_dev)  # 只在开发环境启用 reload
```

#### 2. start.sh
- 添加脚本目录检测，确保在正确的目录执行
- 进入 backend 目录后再执行操作
- 自动从 `.env.example` 创建 `.env` 文件
- 设置 `ENV=production` 环境变量
- 改进错误提示和用户引导

#### 3. backend/.env.example
- 修正版本号为 0.1.3
- 设置 `DEBUG=false`（生产环境默认值）
- 添加更多 CORS 源配置
- 添加配置说明注释

#### 4. scripts/build-release.sh（新增）
- 规范的打包脚本
- 自动排除开发文件（.env, venv, node_modules, .git 等）
- 生成 SHA256 校验和
- 提供测试和发布指引

## 安装说明

### 首次安装

1. 下载发布包：
   ```bash
   # 下载到任意目录
   cd ~/Downloads
   ```

2. 解压：
   ```bash
   tar -xzf claude-manager-v0.1.3-macos-arm64.tar.gz
   cd claude-manager-v0.1.3-macos-arm64
   ```

3. 运行启动脚本：
   ```bash
   ./start.sh
   ```

4. 首次运行会自动创建 `.env` 文件，编辑配置：
   ```bash
   nano backend/.env
   # 或使用你喜欢的编辑器
   ```

5. 重新启动：
   ```bash
   ./start.sh
   ```

### 从 v0.1.2 升级

如果你已经安装了 v0.1.2，建议重新安装：

1. 备份数据库（如果有重要数据）：
   ```bash
   cp backend/claude_manager.db ~/claude_manager_backup.db
   ```

2. 删除旧版本，按照上述"首次安装"步骤安装新版本

3. 恢复数据库：
   ```bash
   cp ~/claude_manager_backup.db backend/claude_manager.db
   ```

## 验证安装

启动成功后，访问以下地址验证：

- API 文档: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc
- 健康检查: http://localhost:8000/health

## 已知问题

无

## 下一版本计划

- 前端界面开发
- WebSocket 实时监控
- Workflow 执行引擎

## 技术支持

如遇到问题，请提供以下信息：

1. 操作系统版本：`sw_vers`
2. Python 版本：`python3 --version`
3. 错误日志：`backend/logs/` 目录下的日志文件
4. 启动输出：完整的 `./start.sh` 输出

## 文件校验

**SHA256 校验和**:
```
31f90e28751c04b036f18324dcf461de3b2d3e4bad15ae5b8e97df1d0d0f6d9f
```

验证文件完整性：
```bash
shasum -a 256 claude-manager-v0.1.3-macos-arm64.tar.gz
```
